{% extends './administracao.html' %}
{% load static %}
{% block conteudo %}
<div class="criar_produto">
    
    <form id="form-criar-produto" action="produto_criar" method="post" class="formulario-criacao" enctype="multipart/form-data">
        {% csrf_token %}
        <h1>CRIAR PRODUTO</h1>

        <div class="entrada-imagens">
            <input type="file" name="imagem_1" id="imagem_1">
            <input type="file" name="imagem_2" id="imagem_2">
            <input type="file" name="imagem_3" id="imagem_3">
            <input type="file" name="imagem_4" id="imagem_4">
            <input type="file" name="imagem_5" id="imagem_5">
        </div>
        <span id="erro-imagem" class="erro-msg" style="color:red; font-size:14px;"></span>

        <p>NOME: 
            <input type="text" name="nome" class="entrada-dado-produto" required>
            <span class="erro-msg"></span>
        </p>

        <p>SKU: 
            <input type="text" name="sku" class="entrada-dado-produto" required>
            <span class="erro-msg"></span>
        </p>

        <p>MARCA: 
            <input type="text" name="marca" class="entrada-dado-produto" required>
            <span class="erro-msg"></span>
        </p>

        <p>CATEGORIA:
            <select name="categoria" id="CATEGORIA" required>
                <option value="">-- Selecione uma categoria --</option>
                {% for categoria in categorias %}
                    <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
                {% endfor %}
            </select>
            <span class="erro-msg"></span>
        </p>

        <p>ML: 
            <input type="number" name="ml" class="entrada-dado-produto" required>
            <span class="erro-msg"></span>
        </p>

        <p>PREÇO: 
            <input type="number" step="0.01" name="preco" class="entrada-dado-produto" required>
            <span class="erro-msg"></span>
        </p>

        <p>ESTOQUE: 
            <input type="number" name="estoque" class="entrada-dado-produto" required>
            <span class="erro-msg"></span>
        </p>

        <p>TAMANHO: 
            <input type="text" name="tamanho" class="entrada-dado-produto" required>
            <span class="erro-msg"></span>
        </p>

        <button type="submit">CRIAR</button>
    </form>
</div>

<script>
// ------------------ VALIDAÇÃO JAVASCRIPT ------------------

document.getElementById("form-criar-produto").addEventListener("submit", function(e) {
    let valido = true;

    // Limpar mensagens anteriores
    document.querySelectorAll(".erro-msg").forEach(el => el.innerText = "");
    document.getElementById("erro-imagem").innerText = "";

    // Obter campos
    const nome = document.querySelector("input[name='nome']");
    const sku = document.querySelector("input[name='sku']");
    const marca = document.querySelector("input[name='marca']");
    const categoria = document.getElementById("CATEGORIA");
    const ml = document.querySelector("input[name='ml']");
    const preco = document.querySelector("input[name='preco']");
    const estoque = document.querySelector("input[name='estoque']");
    const tamanho = document.querySelector("input[name='tamanho']");

    const imagens = [
        document.getElementById("imagem_1"),
        document.getElementById("imagem_2"),
        document.getElementById("imagem_3"),
        document.getElementById("imagem_4"),
        document.getElementById("imagem_5")
    ];

    // Função de erro
    function erro(campo, msg) {
        campo.nextElementSibling.innerText = msg;
        campo.style.border = "1px solid red";
        valido = false;
    }

    function limpar(campo) {
        campo.style.border = "";
    }

    // ----------- VALIDAÇÃO DE CAMPOS -----------

    if (nome.value.trim() === "") erro(nome, "O nome é obrigatório.");
    else limpar(nome);

    if (sku.value.trim() === "") erro(sku, "O SKU é obrigatório.");
    else limpar(sku);

    if (marca.value.trim() === "") erro(marca, "A marca é obrigatória.");
    else limpar(marca);

    if (categoria.value === "") erro(categoria, "Selecione uma categoria.");
    else limpar(categoria);

    if (ml.value === "" || ml.value <= 0) erro(ml, "Informe um valor válido.");
    else limpar(ml);

    if (preco.value === "" || preco.value <= 0) erro(preco, "Informe um preço válido.");
    else limpar(preco);

    if (estoque.value === "" || estoque.value < 0) erro(estoque, "Estoque inválido.");
    else limpar(estoque);

    if (tamanho.value.trim() === "") erro(tamanho, "O tamanho é obrigatório.");
    else limpar(tamanho);

    // ----------- VALIDAÇÃO DE IMAGENS -----------
    let peloMenosUmaImagem = imagens.some(img => img.files.length > 0);

    if (!peloMenosUmaImagem) {
        document.getElementById("erro-imagem").innerText = "Envie pelo menos uma imagem.";
        valido = false;
    }

    // Impede envio se tiver erro
    if (!valido) e.preventDefault();
});
</script>

{% endblock %}
